<% content_for :title, @entity.name %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900"><%= @entity.name %></h1>
    <% if Current.user.administrator?(@entity) %>
      <div class="flex items-center space-x-2">
        <%= link_to "Edit", edit_entity_path(@entity), class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
        <%= button_to "Archive", entity_path(@entity), 
            method: :delete, 
            class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",
            data: { turbo_confirm: "Are you sure you want to archive this entity?" } %>
      </div>
    <% end %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Entity Details -->
    <div class="bg-white shadow-sm rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Entity Details</h3>
      <dl class="space-y-3">
        <div>
          <dt class="text-sm font-medium text-gray-500">Name</dt>
          <dd class="text-sm text-gray-900"><%= @entity.name %></dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Status</dt>
          <dd class="text-sm text-gray-900">
            <% if @entity.is_archived? %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Archived</span>
            <% else %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Active</span>
            <% end %>
          </dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Created</dt>
          <dd class="text-sm text-gray-900"><%= @entity.created_at.strftime("%B %d, %Y") %></dd>
        </div>
      </dl>
    </div>

    <!-- Quick Stats -->
    <div class="bg-white shadow-sm rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Stats</h3>
      <dl class="space-y-3">
        <div>
          <dt class="text-sm font-medium text-gray-500">Accounts</dt>
          <dd class="text-2xl font-bold text-gray-900"><%= @entity.accounts.count %></dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Transactions</dt>
          <dd class="text-2xl font-bold text-gray-900"><%= @entity.transactions.count %></dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Users</dt>
          <dd class="text-2xl font-bold text-gray-900"><%= @entity.users.count %></dd>
        </div>
      </dl>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white shadow-sm rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Actions</h3>
      <div class="space-y-3">
        <%= link_to "View Transactions", entity_transactions_path(@entity), class: "block w-full text-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
        <%= link_to "View Accounts", entity_accounts_path(@entity), class: "block w-full text-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
      </div>
    </div>
  </div>

  <!-- User Access -->
  <% if @accesses.any? %>
    <div class="mt-8 bg-white shadow-sm rounded-lg overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">User Access</h3>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Access Type</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Granted</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @accesses.each do |access| %>
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= access.user.email_address %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= access.class.name.gsub('Access', '').titleize %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= access.created_at.strftime("%B %d, %Y") %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div>
